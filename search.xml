[{"title":"Setup Highcharts Export Server using docker iamge","url":"http://christhai.github.io/2016/07/13/Setup-Highcharts-Export-Server-using-docker-iamge/","content":"<p>I build highcharts Export server with docker image when I work at Highsoft company, you can find it on official Github repo.<br>It is public and easy to use.</p>\n<h2 id=\"Building-Docker-image-from-source\"><a href=\"#Building-Docker-image-from-source\" class=\"headerlink\" title=\"Building Docker image from source\"></a>Building Docker image from source</h2><p>To build from source you need to clone the git repo and run docker build:</p>\n<figure class=\"highlight armasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">git</span> clone https://github.com/highcharts/highcharts-<span class=\"meta\">export</span>-server.git</span><br><span class=\"line\"><span class=\"symbol\">docker</span> <span class=\"keyword\">build </span>-t highcharts-<span class=\"meta\">export</span>-server:&lt;TAG&gt; .</span><br></pre></td></tr></table></figure>\n<p>Please make sure that uncomment those lines regarding downloading highcharts.js in Dockerfile before you run docker build. Otherwise, Docker image won’t work.</p>\n<h2 id=\"Running\"><a href=\"#Running\" class=\"headerlink\" title=\"Running\"></a>Running</h2><p>To simply run the container:</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">run</span> -p <span class=\"number\">8080</span>:<span class=\"number\">8080</span> <span class=\"comment\">--rm -it highcharts-export-server:&lt;TAG&gt;</span></span><br></pre></td></tr></table></figure>\n<p>You can then browse to http://<docker_host>:8080 to view the live export-server. To find your DOCKER_HOST use the docker inspect to get the IP address.</docker_host></p>\n<h2 id=\"Custiomize-export-server\"><a href=\"#Custiomize-export-server\" class=\"headerlink\" title=\"Custiomize export-server\"></a>Custiomize export-server</h2><h3 id=\"Choose-Highcharts-JS-version\"><a href=\"#Choose-Highcharts-JS-version\" class=\"headerlink\" title=\"Choose Highcharts JS version\"></a>Choose Highcharts JS version</h3><p>Within Dockerfile, you can declare the specific version of highcharts you gonna use and specific js modules as well.<br>For licensing reasons, it’s recommended to use the highcharts compiled files from code.highcharts.com/[highcharts-version-you-use]/<br>and when you use them, you acknowledge that you own highcharts license.</p>\n<p>In Dockerfile,  find these lines and config the specific modules you gonna include docker container or not.<br><figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ENV</span> HIGHCHARTS_VERSION <span class=\"number\">4.2</span>.<span class=\"number\">5</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span> <span class=\"bash\">wget http://code.highcharts.com/<span class=\"variable\">$HIGHCHARTS_VERSION</span>/highcharts.js \\</span><br><span class=\"line\">&amp;&amp;  wget http://code.highcharts.com/stock/<span class=\"variable\">$HIGHCHARTS_VERSION</span>/highstock.js \\</span><br><span class=\"line\">&amp;&amp;  wget http://code.highcharts.com/maps/<span class=\"variable\">$HIGHCHARTS_VERSION</span>/highmaps.js</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"Add-Fonts\"><a href=\"#Add-Fonts\" class=\"headerlink\" title=\"Add Fonts\"></a>Add Fonts</h3><p>You can find more fonts online and place them in this location /fonts/usr/share/fonts<br>Note that you have to be responsible of authorization of using some fonts</p>\n<h3 id=\"Build-your-own-docker-image-to-Dockerhub\"><a href=\"#Build-your-own-docker-image-to-Dockerhub\" class=\"headerlink\" title=\"Build your own docker image to Dockerhub\"></a>Build your own docker image to Dockerhub</h3><p>Build docker image<br><figure class=\"highlight armasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker <span class=\"keyword\">build </span>-t &lt;DOCKER_HUB&gt;/highcharts-<span class=\"meta\">export</span>-prod:<span class=\"number\">424</span> .</span><br></pre></td></tr></table></figure></p>\n<p>Run it<br><figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker <span class=\"built_in\">run</span> -p <span class=\"number\">8080</span>:<span class=\"number\">8080</span> <span class=\"comment\">--rm -it  &lt;DOCKER_HUB&gt;/highcharts-export-prod:424</span></span><br></pre></td></tr></table></figure></p>\n"},{"title":"Using Elastic Beanstalk with Amazon CloudWatch Logs","url":"http://christhai.github.io/2016/07/13/Using-Elastic-Beanstalk-with-Amazon-CloudWatch-Logs/","content":"<p>The official toturial is here:</p>\n<p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.cloudwatchlogs.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.cloudwatchlogs.html</a></p>\n<h3 id=\"Get-Started-in-Two-Steps\"><a href=\"#Get-Started-in-Two-Steps\" class=\"headerlink\" title=\"Get Started in Two Steps\"></a>Get Started in Two Steps</h3><p>Step 1:<a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.cloudwatchlogs.html#AWSHowTo.cloudwatchlogs.permissions\" target=\"_blank\" rel=\"external\"> Grant IAM Permissions for the CloudWatch Logs Agent</a></p>\n<p>Step 2:<a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.cloudwatchlogs.html#AWSHowTo.cloudwatchlogs.files\" target=\"_blank\" rel=\"external\"> Set Up CloudWatch Logs Integration with Configuration Files</a></p>\n<a id=\"more\"></a>\n<p>When you create or update an environment, you can use the configuration files below to set up and configure integration with CloudWatch Logs. You can include these configuration files in the .ebextensions directory at the top level of your application source bundle.</p>\n<ul>\n<li><p>cwl-setup.config – This file installs the CloudWatch Logs agent on each Amazon EC2 instance in your environment and then configures the agent.</p>\n</li>\n<li><p>cwl-webrequest-metrics.config – This file specifies which logs the CloudWatch Logs agent monitors.</p>\n</li>\n<li><p>eb-logs.config – This file sets up the CloudWatch Logs log files for the CloudWatch Logs agent.</p>\n</li>\n</ul>\n<h3 id=\"How-to-use-CloudWatch-Logs-to-monitor-servers\"><a href=\"#How-to-use-CloudWatch-Logs-to-monitor-servers\" class=\"headerlink\" title=\"How to use CloudWatch Logs to monitor servers\"></a>How to use CloudWatch Logs to monitor servers</h3><p>Go to CloudWatch -  Log Groups  -  “choose which EB APP log you wanna look” -  EC2 Instance</p>\n<p>Take highchartsSite-env as example, I have wrote some configs that  obtaining  Nginx log files from server. so that now we have a real-time log stream when some failures occur.</p>\n<p>Note, you can also use filter function to deeply check more info, like searching some “error” message</p>\n<p><strong>cwl-webrequest-metrics.config:</strong></p>\n<figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">###############################################################################</span></span><br><span class=\"line\"><span class=\"meta\">## Option Settings</span></span><br><span class=\"line\"><span class=\"meta\">##    Namespace: <span class=\"string\">\"aws:elasticbeanstalk:application:environment\"</span></span></span><br><span class=\"line\"><span class=\"meta\">##    OptionName: WebRequestCWLogGroup</span></span><br><span class=\"line\"><span class=\"meta\">##       Default:   &lt;EnvironmentName&gt;-webrequests</span></span><br><span class=\"line\"><span class=\"meta\">##    Description: This is the name of the cloudwatch log group for web requests (access log)</span></span><br><span class=\"line\"><span class=\"meta\">##</span></span><br><span class=\"line\"><span class=\"meta\">## To get an SNS alert, add a subscription to the Elastic Beanstalk Notification</span></span><br><span class=\"line\"><span class=\"meta\">##   topic.  (e.g. set your Notificiation Endpoint to your email address)</span></span><br><span class=\"line\"><span class=\"meta\">##</span></span><br><span class=\"line\"><span class=\"meta\">## Metrics</span></span><br><span class=\"line\"><span class=\"meta\">##  Namespace:  ElasticBeanstalk/&lt;EnvironmentName&gt;</span></span><br><span class=\"line\"><span class=\"meta\">##  Metrics:    CWLHttp4xx  CWLHttp5xx</span></span><br><span class=\"line\"><span class=\"meta\">##</span></span><br><span class=\"line\"><span class=\"meta\">## Cloudwatch Alarms</span></span><br><span class=\"line\"><span class=\"meta\">##   CWLHttp5xxCount   - this alarm fires <span class=\"meta-keyword\">if</span> the number of calls returning</span></span><br><span class=\"line\"><span class=\"meta\">##                        5xx response codes &gt; 10</span></span><br><span class=\"line\"><span class=\"meta\">##   CWLHttp4xxPercent - this alarm fires <span class=\"meta-keyword\">if</span> the percentage of calls returning</span></span><br><span class=\"line\"><span class=\"meta\">##                        4xx response codes &gt; 10%</span></span><br><span class=\"line\"><span class=\"meta\">##</span></span><br><span class=\"line\"><span class=\"meta\">###############################################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"># Nginx access log pattern:</span></span><br><span class=\"line\"><span class=\"meta\"># $remote_addr - $remote_user [$time_local] <span class=\"string\">\"$request\"</span> $status $body_bytes_sent <span class=\"string\">\"$http_referer\"</span> <span class=\"string\">\"$http_user_agent\"</span> <span class=\"string\">\"$http_x_forwarded_for\"</span></span></span><br><span class=\"line\"><span class=\"symbol\">Mappings:</span></span><br><span class=\"line\"><span class=\"symbol\">  CWLogs:</span></span><br><span class=\"line\"><span class=\"symbol\">    WebRequestLogGroup:</span></span><br><span class=\"line\"><span class=\"symbol\">      LogFile:</span> <span class=\"string\">\"/var/log/containers/nginx-proxy/access.log\"</span></span><br><span class=\"line\"><span class=\"symbol\">      TimestampFormat:</span> <span class=\"string\">\"%d/%b/%Y:%H:%M:%S %z\"</span></span><br><span class=\"line\"><span class=\"symbol\">    FilterPatterns:</span></span><br><span class=\"line\"><span class=\"symbol\">      Http4xxMetricFilter:</span> <span class=\"string\">\"[..., status=4*, size, referer, agent, xforward]\"</span></span><br><span class=\"line\"><span class=\"symbol\">      HttpNon4xxMetricFilter:</span> <span class=\"string\">\"[..., status!=4*, size, referer, agent, xforward]\"</span></span><br><span class=\"line\"><span class=\"symbol\">      Http5xxMetricFilter:</span> <span class=\"string\">\"[..., status=5*, size, referer, agent, xforward]\"</span></span><br><span class=\"line\"><span class=\"symbol\">      HttpNon5xxMetricFilter:</span> <span class=\"string\">\"[..., status!=5*, size, referer, agent, xforward]\"</span></span><br><span class=\"line\"><span class=\"symbol\"></span><br><span class=\"line\">  CWErrorLogs:</span></span><br><span class=\"line\"><span class=\"symbol\">    WebErrorLogGroup:</span></span><br><span class=\"line\"><span class=\"symbol\">      LogFile:</span> <span class=\"string\">\"/var/log/containers/nginx-proxy/highcharts-error.log\"</span></span><br><span class=\"line\"><span class=\"symbol\">      TimestampFormat:</span> <span class=\"string\">\"%a %b %d %H:%M:%S\"</span></span><br><span class=\"line\"><span class=\"symbol\">    FilterPatterns:</span></span><br><span class=\"line\"><span class=\"symbol\">      AllErrorsFilter:</span> <span class=\"string\">\"[timestamp, type = *error*, ...]\"</span></span><br><span class=\"line\"><span class=\"symbol\">Outputs:</span></span><br><span class=\"line\"><span class=\"symbol\">  WebRequestCWLogGroup:</span></span><br><span class=\"line\"><span class=\"symbol\">    Description:</span> <span class=\"string\">\"The name of the Cloudwatch Logs Log Group created for this environments web server access logs. You can specify this by setting the value for the environment variable: WebRequestCWLogGroup. Please note: if you update this value, then you will need to go and clear out the old cloudwatch logs group and delete it through Cloudwatch Logs.\"</span></span><br><span class=\"line\"><span class=\"symbol\">    Value:</span> &#123; <span class=\"string\">\"Ref\"</span> : <span class=\"string\">\"AWSEBCloudWatchLogs8832c8d3f1a54c238a40e36f31ef55a0WebRequestLogGroup\"</span>&#125;</span><br><span class=\"line\"><span class=\"symbol\">  WebErrorCWLogGroup:</span></span><br><span class=\"line\"><span class=\"symbol\">    Description:</span> <span class=\"string\">\"Apache error log - WebErrorCWLogGroup\"</span></span><br><span class=\"line\"><span class=\"symbol\">    Value:</span> &#123; <span class=\"string\">\"Ref\"</span> : <span class=\"string\">\"AWSEBCloudWatchLogs8832c8d3f1a54c238a40e36f31ef55a0WebErrorLogGroup\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Resources :</span><br><span class=\"line\"><span class=\"symbol\">  AWSEBCloudWatchLogs8832c8d3f1a54c238a40e36f31ef55a0WebRequestLogGroup:</span>    <span class=\"meta\">## Must have prefix:  AWSEBCloudWatchLogs8832c8d3f1a54c238a40e36f31ef55a0</span></span><br><span class=\"line\"><span class=\"symbol\">    Type:</span> <span class=\"string\">\"AWS::Logs::LogGroup\"</span></span><br><span class=\"line\"><span class=\"symbol\">    DependsOn:</span> AWSEBBeanstalkMetadata</span><br><span class=\"line\"><span class=\"symbol\">    DeletionPolicy:</span> Retain     <span class=\"meta\">## this is required</span></span><br><span class=\"line\"><span class=\"symbol\">    Properties:</span></span><br><span class=\"line\"><span class=\"symbol\">      LogGroupName:</span></span><br><span class=\"line\">        <span class=\"string\">\"Fn::GetOptionSetting\"</span>:</span><br><span class=\"line\"><span class=\"symbol\">          Namespace:</span> <span class=\"string\">\"aws:elasticbeanstalk:application:environment\"</span></span><br><span class=\"line\"><span class=\"symbol\">          OptionName:</span> WebRequestCWLogGroup</span><br><span class=\"line\"><span class=\"symbol\">          DefaultValue:</span> &#123;<span class=\"string\">\"Fn::Join\"</span>:[<span class=\"string\">\"-\"</span>, [&#123; <span class=\"string\">\"Ref\"</span>:<span class=\"string\">\"AWSEBEnvironmentName\"</span> &#125;, <span class=\"string\">\"webrequests\"</span>]]&#125;</span><br><span class=\"line\"><span class=\"symbol\">      RetentionInDays:</span> <span class=\"number\">14</span></span><br><span class=\"line\"><span class=\"symbol\"></span><br><span class=\"line\">  AWSEBCloudWatchLogs8832c8d3f1a54c238a40e36f31ef55a0WebErrorLogGroup:</span></span><br><span class=\"line\"><span class=\"symbol\">    Type:</span> <span class=\"string\">\"AWS::Logs::LogGroup\"</span></span><br><span class=\"line\"><span class=\"symbol\">    DependsOn:</span> AWSEBBeanstalkMetadata</span><br><span class=\"line\"><span class=\"symbol\">    DeletionPolicy:</span> Retain     <span class=\"meta\">## this is required</span></span><br><span class=\"line\"><span class=\"symbol\">    Properties:</span></span><br><span class=\"line\"><span class=\"symbol\">      LogGroupName:</span></span><br><span class=\"line\">        <span class=\"string\">\"Fn::GetOptionSetting\"</span>:</span><br><span class=\"line\"><span class=\"symbol\">          Namespace:</span> <span class=\"string\">\"aws:elasticbeanstalk:application:environment\"</span></span><br><span class=\"line\"><span class=\"symbol\">          OptionName:</span> WebErrorCWLogGroup</span><br><span class=\"line\"><span class=\"symbol\">          DefaultValue:</span> &#123;<span class=\"string\">\"Fn::Join\"</span>:[<span class=\"string\">\"-\"</span>, [&#123; <span class=\"string\">\"Ref\"</span>:<span class=\"string\">\"AWSEBEnvironmentName\"</span> &#125;, <span class=\"string\">\"weberrors\"</span>]]&#125;</span><br><span class=\"line\"><span class=\"symbol\">      RetentionInDays:</span> <span class=\"number\">14</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">## Register the files/log groups for monitoring</span></span><br><span class=\"line\"><span class=\"symbol\">  AWSEBAutoScalingGroup:</span></span><br><span class=\"line\"><span class=\"symbol\">    Metadata:</span></span><br><span class=\"line\">      <span class=\"string\">\"AWS::CloudFormation::Init\"</span>:</span><br><span class=\"line\"><span class=\"symbol\">        CWLogsAgentConfigSetup:</span></span><br><span class=\"line\"><span class=\"symbol\">          files:</span></span><br><span class=\"line\">            <span class=\"meta\">## any .conf file put into /tmp/cwlogs/conf.d will be added to the cwlogs config (see cwl-agent.config)</span></span><br><span class=\"line\">            <span class=\"string\">\"/tmp/cwlogs/conf.d/nginx-access.conf\"</span>:</span><br><span class=\"line\">              content : |</span><br><span class=\"line\">                [nginx-access_log]</span><br><span class=\"line\">                file = `&#123;<span class=\"string\">\"Fn::FindInMap\"</span>:[<span class=\"string\">\"CWLogs\"</span>, <span class=\"string\">\"WebRequestLogGroup\"</span>, <span class=\"string\">\"LogFile\"</span>]&#125;`</span><br><span class=\"line\">                log_group_name = `&#123; <span class=\"string\">\"Ref\"</span> : <span class=\"string\">\"AWSEBCloudWatchLogs8832c8d3f1a54c238a40e36f31ef55a0WebRequestLogGroup\"</span> &#125;`</span><br><span class=\"line\">                log_stream_name = &#123;instance_id&#125;_nginx_access</span><br><span class=\"line\">                datetime_format = `&#123;<span class=\"string\">\"Fn::FindInMap\"</span>:[<span class=\"string\">\"CWLogs\"</span>, <span class=\"string\">\"WebRequestLogGroup\"</span>, <span class=\"string\">\"TimestampFormat\"</span>]&#125;`</span><br><span class=\"line\">              mode  : <span class=\"string\">\"000400\"</span></span><br><span class=\"line\">              owner : root</span><br><span class=\"line\">              group : root</span><br><span class=\"line\"><span class=\"symbol\"></span><br><span class=\"line\">          files:</span></span><br><span class=\"line\">            <span class=\"string\">\"/tmp/cwlogs/conf.d/nginx-error.conf\"</span>:</span><br><span class=\"line\">              content : |</span><br><span class=\"line\">                [apache-error_log]</span><br><span class=\"line\">                file = `&#123;<span class=\"string\">\"Fn::FindInMap\"</span>:[<span class=\"string\">\"CWErrorLogs\"</span>, <span class=\"string\">\"WebErrorLogGroup\"</span>, <span class=\"string\">\"LogFile\"</span>]&#125;`</span><br><span class=\"line\">                log_group_name = `&#123; <span class=\"string\">\"Ref\"</span> : <span class=\"string\">\"AWSEBCloudWatchLogs8832c8d3f1a54c238a40e36f31ef55a0WebErrorLogGroup\"</span> &#125;`</span><br><span class=\"line\">                log_stream_name = &#123;instance_id&#125;_nginx_error</span><br><span class=\"line\">                datetime_format = `&#123;<span class=\"string\">\"Fn::FindInMap\"</span>:[<span class=\"string\">\"CWErrorLogs\"</span>, <span class=\"string\">\"WebErrorLogGroup\"</span>, <span class=\"string\">\"TimestampFormat\"</span>]&#125;`</span><br><span class=\"line\">              mode  : <span class=\"string\">\"000400\"</span></span><br><span class=\"line\">              owner : root</span><br><span class=\"line\">              group : root</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">#######################################</span></span><br><span class=\"line\">  <span class=\"meta\">## Cloudwatch Logs Metric Filters</span></span><br><span class=\"line\"></span><br><span class=\"line\">  AWSEBCWLHttp4xxMetricFilter :</span><br><span class=\"line\">    Type : <span class=\"string\">\"AWS::Logs::MetricFilter\"</span></span><br><span class=\"line\">    Properties :</span><br><span class=\"line\"><span class=\"symbol\">      LogGroupName:</span> &#123; <span class=\"string\">\"Ref\"</span> : <span class=\"string\">\"AWSEBCloudWatchLogs8832c8d3f1a54c238a40e36f31ef55a0WebRequestLogGroup\"</span> &#125;</span><br><span class=\"line\">      FilterPattern : &#123;<span class=\"string\">\"Fn::FindInMap\"</span>:[<span class=\"string\">\"CWLogs\"</span>, <span class=\"string\">\"FilterPatterns\"</span>, <span class=\"string\">\"Http4xxMetricFilter\"</span>]&#125;</span><br><span class=\"line\">      MetricTransformations :</span><br><span class=\"line\">        - MetricValue : <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"symbol\">          MetricNamespace:</span> &#123;<span class=\"string\">\"Fn::Join\"</span>:[<span class=\"string\">\"/\"</span>, [<span class=\"string\">\"ElasticBeanstalk\"</span>, &#123;<span class=\"string\">\"Ref\"</span>:<span class=\"string\">\"AWSEBEnvironmentName\"</span>&#125;]]&#125;</span><br><span class=\"line\">          MetricName : CWLHttp4xx</span><br><span class=\"line\"></span><br><span class=\"line\">  AWSEBCWLHttpNon4xxMetricFilter :</span><br><span class=\"line\">    Type : <span class=\"string\">\"AWS::Logs::MetricFilter\"</span></span><br><span class=\"line\">    DependsOn : AWSEBCWLHttp4xxMetricFilter</span><br><span class=\"line\">    Properties :</span><br><span class=\"line\"><span class=\"symbol\">      LogGroupName:</span> &#123; <span class=\"string\">\"Ref\"</span> : <span class=\"string\">\"AWSEBCloudWatchLogs8832c8d3f1a54c238a40e36f31ef55a0WebRequestLogGroup\"</span> &#125;</span><br><span class=\"line\">      FilterPattern : &#123;<span class=\"string\">\"Fn::FindInMap\"</span>:[<span class=\"string\">\"CWLogs\"</span>, <span class=\"string\">\"FilterPatterns\"</span>, <span class=\"string\">\"HttpNon4xxMetricFilter\"</span>]&#125;</span><br><span class=\"line\">      MetricTransformations :</span><br><span class=\"line\">        - MetricValue : <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"symbol\">          MetricNamespace:</span> &#123;<span class=\"string\">\"Fn::Join\"</span>:[<span class=\"string\">\"/\"</span>, [<span class=\"string\">\"ElasticBeanstalk\"</span>, &#123;<span class=\"string\">\"Ref\"</span>:<span class=\"string\">\"AWSEBEnvironmentName\"</span>&#125;]]&#125;</span><br><span class=\"line\">          MetricName : CWLHttp4xx</span><br><span class=\"line\"></span><br><span class=\"line\">  AWSEBCWLHttp5xxMetricFilter :</span><br><span class=\"line\">    Type : <span class=\"string\">\"AWS::Logs::MetricFilter\"</span></span><br><span class=\"line\">    Properties :</span><br><span class=\"line\"><span class=\"symbol\">      LogGroupName:</span> &#123; <span class=\"string\">\"Ref\"</span> : <span class=\"string\">\"AWSEBCloudWatchLogs8832c8d3f1a54c238a40e36f31ef55a0WebRequestLogGroup\"</span> &#125;</span><br><span class=\"line\">      FilterPattern : &#123;<span class=\"string\">\"Fn::FindInMap\"</span>:[<span class=\"string\">\"CWLogs\"</span>, <span class=\"string\">\"FilterPatterns\"</span>, <span class=\"string\">\"Http5xxMetricFilter\"</span>]&#125;</span><br><span class=\"line\">      MetricTransformations :</span><br><span class=\"line\">        - MetricValue : <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"symbol\">          MetricNamespace:</span> &#123;<span class=\"string\">\"Fn::Join\"</span>:[<span class=\"string\">\"/\"</span>, [<span class=\"string\">\"ElasticBeanstalk\"</span>, &#123;<span class=\"string\">\"Ref\"</span>:<span class=\"string\">\"AWSEBEnvironmentName\"</span>&#125;]]&#125;</span><br><span class=\"line\">          MetricName : CWLHttp5xx</span><br><span class=\"line\"></span><br><span class=\"line\">  AWSEBCWLHttpNon5xxMetricFilter :</span><br><span class=\"line\">    Type : <span class=\"string\">\"AWS::Logs::MetricFilter\"</span></span><br><span class=\"line\">    DependsOn : AWSEBCWLHttp5xxMetricFilter</span><br><span class=\"line\">    Properties :</span><br><span class=\"line\"><span class=\"symbol\">      LogGroupName:</span> &#123; <span class=\"string\">\"Ref\"</span> : <span class=\"string\">\"AWSEBCloudWatchLogs8832c8d3f1a54c238a40e36f31ef55a0WebRequestLogGroup\"</span> &#125;</span><br><span class=\"line\">      FilterPattern : &#123;<span class=\"string\">\"Fn::FindInMap\"</span>:[<span class=\"string\">\"CWLogs\"</span>, <span class=\"string\">\"FilterPatterns\"</span>, <span class=\"string\">\"HttpNon5xxMetricFilter\"</span>]&#125;</span><br><span class=\"line\">      MetricTransformations :</span><br><span class=\"line\">        - MetricValue : <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"symbol\">          MetricNamespace:</span> &#123;<span class=\"string\">\"Fn::Join\"</span>:[<span class=\"string\">\"/\"</span>, [<span class=\"string\">\"ElasticBeanstalk\"</span>, &#123;<span class=\"string\">\"Ref\"</span>:<span class=\"string\">\"AWSEBEnvironmentName\"</span>&#125;]]&#125;</span><br><span class=\"line\">          MetricName : CWLHttp5xx</span><br><span class=\"line\"></span><br><span class=\"line\">  AWSEBCWLAllErrorsFilter :</span><br><span class=\"line\">    Type : <span class=\"string\">\"AWS::Logs::MetricFilter\"</span></span><br><span class=\"line\">    Properties :</span><br><span class=\"line\"><span class=\"symbol\">      LogGroupName:</span> &#123; <span class=\"string\">\"Ref\"</span> : <span class=\"string\">\"AWSEBCloudWatchLogs8832c8d3f1a54c238a40e36f31ef55a0WebErrorLogGroup\"</span> &#125;</span><br><span class=\"line\">      FilterPattern : &#123;<span class=\"string\">\"Fn::FindInMap\"</span>:[<span class=\"string\">\"CWErrorLogs\"</span>, <span class=\"string\">\"FilterPatterns\"</span>, <span class=\"string\">\"AllErrorsFilter\"</span>]&#125;</span><br><span class=\"line\">      MetricTransformations :</span><br><span class=\"line\">        - MetricValue : <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"symbol\">          MetricNamespace:</span> &#123;<span class=\"string\">\"Fn::Join\"</span>:[<span class=\"string\">\"/\"</span>, [<span class=\"string\">\"ElasticBeanstalk\"</span>, &#123;<span class=\"string\">\"Ref\"</span>:<span class=\"string\">\"AWSEBEnvironmentName\"</span>&#125;]]&#125;</span><br><span class=\"line\">          MetricName : CWLAllErrorRecords</span><br><span class=\"line\">  <span class=\"meta\">######################################################</span></span><br><span class=\"line\">  <span class=\"meta\">## Alarms</span></span><br><span class=\"line\"></span><br><span class=\"line\">  AWSEBCWLHttp5xxCountAlarm :</span><br><span class=\"line\">    Type : <span class=\"string\">\"AWS::CloudWatch::Alarm\"</span></span><br><span class=\"line\">    DependsOn : AWSEBCWLHttpNon5xxMetricFilter</span><br><span class=\"line\">    Properties :</span><br><span class=\"line\"><span class=\"symbol\">      AlarmDescription:</span> <span class=\"string\">\"Application is returning too many 5xx responses (count too high).\"</span></span><br><span class=\"line\"><span class=\"symbol\">      MetricName:</span> CWLHttp5xx</span><br><span class=\"line\"><span class=\"symbol\">      Namespace:</span> &#123;<span class=\"string\">\"Fn::Join\"</span>:[<span class=\"string\">\"/\"</span>, [<span class=\"string\">\"ElasticBeanstalk\"</span>, &#123;<span class=\"string\">\"Ref\"</span>:<span class=\"string\">\"AWSEBEnvironmentName\"</span>&#125;]]&#125;</span><br><span class=\"line\"><span class=\"symbol\">      Statistic:</span> Sum</span><br><span class=\"line\"><span class=\"symbol\">      Period:</span> <span class=\"number\">60</span></span><br><span class=\"line\"><span class=\"symbol\">      EvaluationPeriods:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"symbol\">      Threshold:</span> <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"symbol\">      ComparisonOperator:</span> GreaterThanThreshold</span><br><span class=\"line\"><span class=\"symbol\">      AlarmActions:</span></span><br><span class=\"line\">        - <span class=\"string\">\"Fn::If\"</span>:</span><br><span class=\"line\">            - SNSTopicExists</span><br><span class=\"line\">            - <span class=\"string\">\"Fn::FindInMap\"</span>:</span><br><span class=\"line\">                - AWSEBOptions</span><br><span class=\"line\">                - options</span><br><span class=\"line\">                - EBSNSTopicArn</span><br><span class=\"line\">            - &#123; <span class=\"string\">\"Ref\"</span> : <span class=\"string\">\"AWS::NoValue\"</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  AWSEBCWLHttp4xxPercentAlarm :</span><br><span class=\"line\">    Type : <span class=\"string\">\"AWS::CloudWatch::Alarm\"</span></span><br><span class=\"line\">    DependsOn : AWSEBCWLHttpNon4xxMetricFilter</span><br><span class=\"line\">    Properties :</span><br><span class=\"line\"><span class=\"symbol\">      AlarmDescription:</span> <span class=\"string\">\"Application is returning too many 4xx responses (percentage too high).\"</span></span><br><span class=\"line\"><span class=\"symbol\">      MetricName:</span> CWLHttp4xx</span><br><span class=\"line\"><span class=\"symbol\">      Namespace:</span> &#123;<span class=\"string\">\"Fn::Join\"</span>:[<span class=\"string\">\"/\"</span>, [<span class=\"string\">\"ElasticBeanstalk\"</span>, &#123;<span class=\"string\">\"Ref\"</span>:<span class=\"string\">\"AWSEBEnvironmentName\"</span>&#125;]]&#125;</span><br><span class=\"line\"><span class=\"symbol\">      Statistic:</span> Average</span><br><span class=\"line\"><span class=\"symbol\">      Period:</span> <span class=\"number\">60</span></span><br><span class=\"line\"><span class=\"symbol\">      EvaluationPeriods:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"symbol\">      Threshold:</span> <span class=\"number\">0.10</span></span><br><span class=\"line\"><span class=\"symbol\">      ComparisonOperator:</span> GreaterThanThreshold</span><br><span class=\"line\"><span class=\"symbol\">      AlarmActions:</span></span><br><span class=\"line\">        - <span class=\"string\">\"Fn::If\"</span>:</span><br><span class=\"line\">            - SNSTopicExists</span><br><span class=\"line\">            - <span class=\"string\">\"Fn::FindInMap\"</span>:</span><br><span class=\"line\">                - AWSEBOptions</span><br><span class=\"line\">                - options</span><br><span class=\"line\">                - EBSNSTopicArn</span><br><span class=\"line\">            - &#123; <span class=\"string\">\"Ref\"</span> : <span class=\"string\">\"AWS::NoValue\"</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            **Commands review:**</span><br></pre></td></tr></table></figure>\n"},{"title":"Deploying Applications with Elastic Beanstalk","url":"http://christhai.github.io/2016/07/11/Deploying-Applications-with-Elastic-Beanstalk/","content":"<p>Elastic Beanstalk Key Concepts</p>\n<p>Deploying a Web App with Beanstalk</p>\n<p>Working with the EB CLI</p>\n<p>Advanced Environment Customization</p>\n<p>Rolling &amp; Blue-green Deployments</p>\n<p>Working with Docker</p>\n"},{"title":"Test DOCKER.CLOUD(TUTUM) CD Automation Deployment","url":"http://christhai.github.io/2016/07/07/TEST-DOCKER-CLOUD-TUTUM-CD-AUTO-TOOL/","content":"<h3 id=\"Step-one-link-to-AMAZON-EC2\"><a href=\"#Step-one-link-to-AMAZON-EC2\" class=\"headerlink\" title=\"Step one, link to AMAZON EC2\"></a>Step one, link to AMAZON EC2</h3><p>Go to “cloud setting”, - “cloud providers”</p>\n<p>Create a IAM user “docker” and attach policy  “access to EC2”</p>\n<h3 id=\"Step-two-create-a-Node-clusters-and-nodes\"><a href=\"#Step-two-create-a-Node-clusters-and-nodes\" class=\"headerlink\" title=\"Step two, create a Node clusters and nodes\"></a>Step two, create a Node clusters and nodes</h3><h3 id=\"Step-three-build-services-from-Repository\"><a href=\"#Step-three-build-services-from-Repository\" class=\"headerlink\" title=\"Step three, build services from Repository\"></a>Step three, build services from Repository</h3><a id=\"more\"></a>\n<h3 id=\"Set-trigger\"><a href=\"#Set-trigger\" class=\"headerlink\" title=\"Set trigger\"></a>Set trigger</h3><h3 id=\"Finally-browser-endpoints-see-webApp\"><a href=\"#Finally-browser-endpoints-see-webApp\" class=\"headerlink\" title=\"Finally, browser endpoints see  webApp\"></a>Finally, browser endpoints see  webApp</h3><p>总结：</p>\n<p>和dockerhub捆绑挺好的，给单个容器比较好用  例如export server<br>但是不知道能不能push到 EB上，或者用stack功能  类似docker compose<br>因为ec2只是单个instance,没有其他组件Load balance 之类的  </p>\n"},{"title":"Using EB CLI","url":"http://christhai.github.io/2016/07/04/Using-EB-CLI/","content":"<p>During the Elastic Beanstalk deploy, it is good to use Eb cli command line, then we do not need to compress the Applicaiton.zip and upload the application file through Webconsole.</p>\n<p>One thing we need to do is make sure that we can authenticate to AWS before we can actually start deploying applications, so let’s create a brand new user to do this. So I’m going to go back into the AWS console, I’m going to go to Services, and then I’m going to go to AIM for Identity Access and Management. I’m going to go to Users to create a new user. So we’ll call this guy EB and hit Create. Now I’m going to need the access keys here so I’ll go ahead and download the credentials. And I’ll go ahead and open this up with Notepad, cause I’m going to need the keys here in just a minute. But for now, let’s go ahead and close this, and then we’ll set up the permissions for our EB user. So we’ll go into the EB user, go to the permissions tab, and then we’ll go ahead and attach a policy to this user. And of course here you could set up a granular policy based on your requirements. I’m just going to give this user administrator access, so we’ll go ahead and attach that policy, and now that we have a user that has permissions, we’re ready to configure the EB CLI and then we can deploy an application.</p>\n<a id=\"more\"></a>\n<p><strong>Commands review:</strong></p>\n<figure class=\"highlight basic\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">803 </span>eb init</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">804 </span> eb status</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">805 </span> eb status haiwTest-env</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">806 </span> eb deploy haiwTest-env</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">812 </span> eb logs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">814 </span> eb logs haiwTest-env</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">816 </span> eb use haiwTest-env-dev</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">821 </span> eb deploy</span><br></pre></td></tr></table></figure>\n<h3 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference:\"></a>Reference:</h3><h4 id=\"eb-deploy-的流程\"><a href=\"#eb-deploy-的流程\" class=\"headerlink\" title=\"eb deploy 的流程\"></a>eb deploy 的流程</h4><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_PHP_cakePHP.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_PHP_cakePHP.html</a></p>\n<h4 id=\"Using-Git-with-the-EB-CLI\"><a href=\"#Using-Git-with-the-EB-CLI\" class=\"headerlink\" title=\"Using Git with the EB CLI\"></a>Using Git with the EB CLI</h4><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-cli-git.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-cli-git.html</a></p>\n<p><a href=\"http://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/eb-cli3-getting-started.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/eb-cli3-getting-started.html</a></p>\n<h4 id=\"Configuring-the-AWS-Command-Line-Interface\"><a href=\"#Configuring-the-AWS-Command-Line-Interface\" class=\"headerlink\" title=\"Configuring the AWS Command Line Interface\"></a>Configuring the AWS Command Line Interface</h4><p><a href=\"http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html</a></p>\n<h4 id=\"More-EB-commands\"><a href=\"#More-EB-commands\" class=\"headerlink\" title=\"More EB commands:\"></a>More EB commands:</h4><p><strong>eb scale</strong></p>\n<p>Description</p>\n<p>Scales the environment to always run on a specified number of instances, setting both the minimum and maximum number of instances to the specified number.</p>\n"},{"title":"Set up website on Elastic Beanstalk using Multi Container","url":"http://christhai.github.io/2016/07/04/Set-up-website-on-Elastic-Beanstalk-using-Multi-Container/","content":"<h2 id=\"Set-up-website-on-Elastic-Beanstalk-using-Multi-Container-PHP-FPM-Nginx\"><a href=\"#Set-up-website-on-Elastic-Beanstalk-using-Multi-Container-PHP-FPM-Nginx\" class=\"headerlink\" title=\"Set up website on Elastic Beanstalk using Multi Container (PHP-FPM + Nginx)\"></a>Set up website on Elastic Beanstalk using Multi Container (PHP-FPM + Nginx)</h2><p>This guide shows you how to setup WebApp  on Elastic Beanstalk using the [PHP-FPM]and [Nginx] Docker images.</p>\n<h2 id=\"The-procedure-of-making-this-work\"><a href=\"#The-procedure-of-making-this-work\" class=\"headerlink\" title=\"The procedure of making this work\"></a>The procedure of making this work</h2><p><a href=\"#heading=h.rilr6oluuna3\">First step, covert docker compose file to Dockerrun.aws.json</a></p>\n<p><a href=\"#heading=h.txmc5fcrcsi1\">Second step, link to RDS</a></p>\n<p>—-&gt;   Think of security group, the instance  need access to RDS</p>\n<p>—-&gt;   Connecting MYSQL RDS needs php-mysql inside docker</p>\n<p>—-&gt;   Upload prebuild or private docker image (PHP with php-mysql) to ECR</p>\n<hr>\n<a id=\"more\"></a>\n<h3 id=\"First-step-covert-docker-compose-file-to-Dockerrun-aws-json\"><a href=\"#First-step-covert-docker-compose-file-to-Dockerrun-aws-json\" class=\"headerlink\" title=\"First step, covert docker compose file to Dockerrun.aws.json\"></a>First step, covert docker compose file to Dockerrun.aws.json</h3><p>Follow this tutorial  <a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html</a></p>\n<p><strong>Topics</strong></p>\n<ul>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create_deploy_docker_ecstutorial_role\" target=\"_blank\" rel=\"external\">Configure a Container Instance IAM Role</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create_deploy_docker_ecstutorial_config\" target=\"_blank\" rel=\"external\">Define Docker Containers</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create_deploy_docker_ecstutorial_code\" target=\"_blank\" rel=\"external\">Add Content</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create_deploy_docker_ecstutorial_deploy\" target=\"_blank\" rel=\"external\">Deploy to Elastic Beanstalk</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create_deploy_docker_ecstutorial_connect\" target=\"_blank\" rel=\"external\">Connect to a Container Instance</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create_deploy_docker_ecstutorial_connect_inspect\" target=\"_blank\" rel=\"external\">Inspect the Amazon ECS Container Agent</a></p>\n</li>\n</ul>\n<p>PS: you can login to the EC2 instance which host docker containers and  the WebAPP could be found on /var/app/current:</p>\n<figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ec2-user@ip-10-0-0-117 ~]$ <span class=\"keyword\">ls</span> /<span class=\"keyword\">var</span>/<span class=\"keyword\">app</span>/current</span><br><span class=\"line\">Dockerrun.aws.json  php-<span class=\"keyword\">app</span>  proxy</span><br></pre></td></tr></table></figure>\n<p>Until now, the webapp is running without the mysql connection</p>\n<h3 id=\"Second-step-link-to-RDS-Mysql\"><a href=\"#Second-step-link-to-RDS-Mysql\" class=\"headerlink\" title=\"Second step, link to RDS Mysql\"></a>Second step, link to RDS Mysql</h3><h4 id=\"1-Think-of-security-group-the-instance-need-access-to-RDS\"><a href=\"#1-Think-of-security-group-the-instance-need-access-to-RDS\" class=\"headerlink\" title=\"1. Think of security group, the instance  need access to RDS\"></a>1. Think of security group, the instance  need access to RDS</h4><p><a href=\"http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithSecurityGroups.html#USER_WorkingWithSecurityGroups.AuthorizingEC2\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithSecurityGroups.html#USER_WorkingWithSecurityGroups.AuthorizingEC2</a></p>\n<p>Login into EC2 instance and see whether can be able to visit RDS</p>\n<p>troubleshooting</p>\n<p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/java-rds.html#create_deploy_Java.rds.troubleshooting\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/java-rds.html#create_deploy_Java.rds.troubleshooting</a></p>\n<p>More reference:</p>\n<p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_PHP.rds.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_PHP.rds.html</a></p>\n<p><a href=\"https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.RDS.html\" target=\"_blank\" rel=\"external\">https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.RDS.html</a></p>\n<p><a href=\"https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.RDS.html#rds-external-ec2classic\" target=\"_blank\" rel=\"external\">https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.RDS.html#rds-external-ec2classic</a></p>\n<p>So far, EC2 instance can access to RDS mysql however Webapp still not work.</p>\n<p>We need mysql client to connect BY USING php-mysql</p>\n<h4 id=\"2-Connecting-MYSQL-RDS-needs-php-mysql-inside-docker\"><a href=\"#2-Connecting-MYSQL-RDS-needs-php-mysql-inside-docker\" class=\"headerlink\" title=\"2. Connecting MYSQL RDS needs php-mysql inside docker\"></a>2. Connecting MYSQL RDS needs php-mysql inside docker</h4><p>Firstly, I add one more database container and test. It was not working.<br>Then I realized I do not need a separate DB container actually. The thing I need is the prebuild or private docker image (PHP with php-mysql)**</p>\n<p>Here is a good doc i followed that solved this:</p>\n<p><a href=\"http://www.michaelgallego.fr/blog/2015/07/18/using-elastic-beanstalk-multi-container-with-php/\" target=\"_blank\" rel=\"external\">http://www.michaelgallego.fr/blog/2015/07/18/using-elastic-beanstalk-multi-container-with-php/</a></p>\n<p>I wanna use docker private images (haiw/php-fpm) in Dockerrun.aws.json, but after testing, I found that it is not allowed and it cause deploy issue.  </p>\n<p>Need to figure out a alternative way.</p>\n<h4 id=\"3-Upload-prebuild-or-private-docker-image-PHP-with-php-mysql-to-ECR\"><a href=\"#3-Upload-prebuild-or-private-docker-image-PHP-with-php-mysql-to-ECR\" class=\"headerlink\" title=\"3. Upload prebuild or private docker image (PHP with php-mysql) to ECR\"></a>3. Upload prebuild or private docker image (PHP with php-mysql) to ECR</h4><p>Toturial:<br><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker.html#docker-images-private\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker.html#docker-images-private</a></p>\n<p>Here is what I did,  </p>\n<p><a href=\"http://aws.amazon.com/ecr/getting-started/\" target=\"_blank\" rel=\"external\">http://aws.amazon.com/ecr/getting-started/</a></p>\n<p>upload docker image to Amazon ECR to use</p>\n<p>  <img src=\"/images/201607/image_6.png\" alt=\"\"></p>\n<p><a href=\"http://docs.aws.amazon.com/AmazonECR/latest/userguide/get-set-up-for-amazon-ecr.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/AmazonECR/latest/userguide/get-set-up-for-amazon-ecr.html</a></p>\n<p>Commands review:</p>\n<figure class=\"highlight basic\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">543 </span> aws ecr <span class=\"keyword\">get</span>-login --region us-east-<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">544 </span> aws configure</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">545 </span> aws ecr <span class=\"keyword\">get</span>-login --region us-east-<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">546 </span> ls</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">547 </span> docker login -u AWS -p CiBwm0YaISJ</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">566 </span> docker build -t haiw/php-fpm:latest .</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">567 </span> docker images</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">568 </span> docker tag  haiw/php-fpm:latest <span class=\"number\">429834746942.d</span>kr.ecr.us-east-<span class=\"number\">1.</span>amazonaws.<span class=\"keyword\">com</span>/php-fpm:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">569 </span> docker push <span class=\"number\">429834746942.d</span>kr.ecr.us-east-<span class=\"number\">1.</span>amazonaws.<span class=\"keyword\">com</span>/php-fpm:latest</span><br></pre></td></tr></table></figure>\n<p>EB APP use docker image from ECR, it also requires permission</p>\n<h4 id=\"4-Configure-Container-Instance-IAM-Role\"><a href=\"#4-Configure-Container-Instance-IAM-Role\" class=\"headerlink\" title=\"4.Configure Container Instance IAM Role\"></a>4.Configure Container Instance IAM Role</h4><p>Instances in a multicontainer Docker environment must have an instance profile with permission to access Amazon EC2 Container Service (Amazon ECS), the service that Elastic Beanstalk uses to coordinate container deployments. To grant Amazon ECS access to the instances in your environment, you must create an IAM container instance policy and attach the policy to the correct IAM role.</p>\n<p><strong>Topics</strong></p>\n<ul>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create-policy\" target=\"_blank\" rel=\"external\">Create the Policy</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create-role\" target=\"_blank\" rel=\"external\">Create the Role (if needed)</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#attach-policy\" target=\"_blank\" rel=\"external\">Attach the Policy to the Role</a></p>\n</li>\n</ul>\n<p>Conclude:<br>EC2 instance needs security group   and   IAM  role   </p>\n<p><strong>让rds给instance  权限 从rds 的 security groups中去授权</strong></p>\n<p><strong>而instance访问 ecs 或者 ecr 在 IAM中设置 </strong></p>\n<p>给 <strong>aws-elasticbeanstalk-ec2-role</strong> 授予权限</p>\n"},{"title":"Create and push php-fpm docker image on AWS ECR(Container Registry)","url":"http://christhai.github.io/2016/06/29/Create-a-new-php-fpm-docker-image-on-AWS-ECR/","content":"<p>You can store your custom Docker images in AWS with <a href=\"http://aws.amazon.com/ecr\" target=\"_blank\" rel=\"external\">Amazon EC2 Container Registry</a> (Amazon ECR). When you store your Docker images in Amazon ECR, Elastic Beanstalk automatically authenticates to the Amazon ECR registry with your environment’s <a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/concepts-roles.html#concepts-roles-instance\" target=\"_blank\" rel=\"external\">instance profile</a>, so you don’t need to <a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker.container.console.html#docker-images-private\" target=\"_blank\" rel=\"external\">generate an authentication file</a> and upload it to Amazon Simple Storage Service (Amazon S3)</p>\n<p>The official tutorial is here,</p>\n<p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker.html#docker-images-private\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker.html#docker-images-private</a></p>\n<p>or you can get started from here and follow the guide:</p>\n<p><a href=\"http://aws.amazon.com/ecr/getting-started/\" target=\"_blank\" rel=\"external\">http://aws.amazon.com/ecr/getting-started/</a></p>\n<a id=\"more\"></a>\n<p>Take a example,  Create a new php-fpm docker image on AWS ECR Used for docker muti-container on EB</p>\n<p><strong>Command review:</strong></p>\n<figure class=\"highlight basic\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">480 </span> aws ecr <span class=\"keyword\">get</span>-login --region us-east-<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"symbol\">481 </span> docker login -u AWS -p</span><br><span class=\"line\"><span class=\"symbol\">482 </span> docker images</span><br><span class=\"line\"><span class=\"symbol\">483 </span> docker build -t christhai/php-app .</span><br><span class=\"line\"><span class=\"symbol\">491 </span> docker tag christhai/php-app:latest <span class=\"number\">42</span>xxxxxxxx2.dkr.ecr.us-east-<span class=\"number\">1.</span>amazonaws.<span class=\"keyword\">com</span>/christhai:php-app</span><br><span class=\"line\"><span class=\"symbol\">492 </span> docker images</span><br><span class=\"line\"><span class=\"symbol\">493 </span> docker push <span class=\"number\">42</span>xxxxxxxx2.dkr.ecr.us-east-<span class=\"number\">1.</span>amazonaws.<span class=\"keyword\">com</span>/christhai:php-app</span><br></pre></td></tr></table></figure>\n<p>  <img src=\"/images/201607/image_6.png\" alt=\"\"></p>\n<p>  <strong>The another thing we have to think about grant permission to instance or EB application IAM ROLE use container from ECR.</strong></p>\n<p>  Take export-server as example, the EB application IAM Role is aws-eleasticbeanstalk-ec2-role</p>\n<p>  Since export serve is build from docker image on Amazon ECR, then we should assign the policy “<a href=\"https://console.aws.amazon.com/iam/home?region=us-west-2#policies/arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryFullAccess\" target=\"_blank\" rel=\"external\">AmazonEC2ContainerRegistryFullAccess</a>“  to aws-eleasticbeanstalk-ec2-role</p>\n<p>  <img src=\"/images/201607/image_7.png\" alt=\"\"></p>\n"},{"title":"Git Tips&QFA Collect","url":"http://christhai.github.io/2016/06/29/Git-Skills/","content":"<p><strong>Topics</strong></p>\n<ul>\n<li><a href=\"##Git Commit issue\">Git Commit issue</a></li>\n<li><a href=\"##Git Diff\">Git diff</a></li>\n<li><a href=\"##Git Branching\">Git Branch (merge&amp;delete)</a></li>\n</ul>\n<h2 id=\"Git-Commit-issue\"><a href=\"#Git-Commit-issue\" class=\"headerlink\" title=\"Git Commit issue\"></a>Git Commit issue</h2><h4 id=\"How-do-I-resolve-git-saying-“Commit-your-changes-or-stash-them-before-you-can-merge”\"><a href=\"#How-do-I-resolve-git-saying-“Commit-your-changes-or-stash-them-before-you-can-merge”\" class=\"headerlink\" title=\"How do I resolve git saying “Commit your changes or stash them before you can merge”?\"></a><a href=\"http://stackoverflow.com/questions/15745045/how-do-i-resolve-git-saying-commit-your-changes-or-stash-them-before-you-can-me\" target=\"_blank\" rel=\"external\">How do I resolve git saying “Commit your changes or stash them before you can merge”?</a></h4><p>you can’t merge with local modifications. Git protects you from losing potentially important changes. You have three options. One is to commit the change using</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">git</span> commit -m <span class=\"string\">\"My message\"</span></span><br></pre></td></tr></table></figure>\n<p>The second is to stash it. stashing acts as a stack, where you can push changes, and you pop them in reverse order.</p>\n<p>To stash type:</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">git</span> stash</span><br></pre></td></tr></table></figure>\n<p>Do the merge, and than pull the stash:</p>\n<figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git stash <span class=\"keyword\">pop</span></span><br></pre></td></tr></table></figure>\n<p>The third options is to discard the local changes using git reset –hard<br><a id=\"more\"></a></p>\n<h4 id=\"Undo-a-commit-and-redo\"><a href=\"#Undo-a-commit-and-redo\" class=\"headerlink\" title=\"Undo a commit and redo\"></a>Undo a commit and redo</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"keyword\">commit</span> -m <span class=\"string\">\"Something terribly misguided\"</span> (<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">$ git <span class=\"keyword\">reset</span> <span class=\"comment\">--soft HEAD~ (2)</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"Git-HowTo-revert-a-commit-already-pushed-to-a-remote-repository\"><a href=\"#Git-HowTo-revert-a-commit-already-pushed-to-a-remote-repository\" class=\"headerlink\" title=\"Git HowTo: revert a commit already pushed to a remote repository\"></a>Git HowTo: revert a commit already pushed to a remote repository</h4><p> <strong>Case 1: Delete the last commit</strong></p>\n<p>Deleting the last commit is the easiest case. Let’s say we have a remote <em>mathnet</em>with branch <em>master</em> that currently points to commit <em>dd61ab32</em>. We want to remove the top commit. Translated to git terminology, we want to force the <em>master</em> branch of the <em>mathnet</em> remote repository to the parent of <em>dd61ab32</em>:</p>\n<figure class=\"highlight elixir\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$ </span>git push mathnet +dd61ab32^<span class=\"symbol\">:master</span></span><br></pre></td></tr></table></figure>\n<p>Where git interprets x^ as the parent of x and + as a forced non-fastforward push. If you have the master branch checked out locally, you can also do it in two simpler steps: First reset the branch to the parent of the current commit, then force-push it to the remote.</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"keyword\">reset</span> <span class=\"keyword\">HEAD</span>^ <span class=\"comment\">--hard</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ git push mathnet -f</span><br></pre></td></tr></table></figure>\n<h2 id=\"Git-Diff\"><a href=\"#Git-Diff\" class=\"headerlink\" title=\"Git Diff\"></a>Git Diff</h2><h4 id=\"How-to-view-file-diff-in-git-before-commit\"><a href=\"#How-to-view-file-diff-in-git-before-commit\" class=\"headerlink\" title=\"How to view file diff in git before commit\"></a><a href=\"http://stackoverflow.com/questions/10039747/how-to-view-file-diff-in-git-before-commit\" target=\"_blank\" rel=\"external\">How to view file diff in git before commit</a></h4><p>If you want to see what you haven’t git added yet:<br><figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff <span class=\"comment\">-- myfile.txt</span></span><br></pre></td></tr></table></figure></p>\n<p>or if you want to see already-added changes<br><figure class=\"highlight brainfuck\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">git</span> <span class=\"comment\">diff</span> <span class=\"literal\">-</span><span class=\"literal\">-</span><span class=\"comment\">cached</span> <span class=\"literal\">-</span><span class=\"literal\">-</span> <span class=\"comment\">myfile</span><span class=\"string\">.</span><span class=\"comment\">txt</span></span><br></pre></td></tr></table></figure></p>\n<p>or<br><figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff HEAD <span class=\"built_in\">file</span></span><br></pre></td></tr></table></figure></p>\n<p>will show you changes you added to your worktree from the last commit. All the changes (staged or not staged) will be shown.</p>\n<h4 id=\"Showing-which-files-have-changed-between-two-revisions\"><a href=\"#Showing-which-files-have-changed-between-two-revisions\" class=\"headerlink\" title=\"Showing which files have changed between two revisions\"></a><a href=\"http://stackoverflow.com/questions/822811/showing-which-files-have-changed-between-two-revisions\" target=\"_blank\" rel=\"external\">Showing which files have changed between two revisions</a></h4><p>Try<br><figure class=\"highlight fortran\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git diff --<span class=\"keyword\">name</span>-<span class=\"keyword\">status</span> master..branchName</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"How-can-I-compare-files-from-two-different-branches\"><a href=\"#How-can-I-compare-files-from-two-different-branches\" class=\"headerlink\" title=\"How can I compare files from two different branches?\"></a><a href=\"http://stackoverflow.com/questions/4099742/how-can-i-compare-files-from-two-different-branches\" target=\"_blank\" rel=\"external\">How can I compare files from two different branches?</a></h4><figure class=\"highlight mipsasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"keyword\">diff </span>can <span class=\"keyword\">show </span>you the <span class=\"keyword\">difference </span><span class=\"keyword\">between </span>two commits:</span><br><span class=\"line\"></span><br><span class=\"line\">git <span class=\"keyword\">diff </span>mybranch master -- myfile.cs</span><br></pre></td></tr></table></figure>\n<h4 id=\"Differences-for-a-certain-folder-between-remote-git-branches\"><a href=\"#Differences-for-a-certain-folder-between-remote-git-branches\" class=\"headerlink\" title=\"Differences for a certain folder between remote git branches\"></a><a href=\"http://stackoverflow.com/questions/12123633/differences-for-a-certain-folder-between-git-branches\" target=\"_blank\" rel=\"external\">Differences for a certain folder between remote git branches</a></h4><figure class=\"highlight gams\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">git</span></span> diff master..origin/yourbranch path/to/folder</span><br></pre></td></tr></table></figure>\n<h4 id=\"git-ahead-behind-info-between-master-and-branch\"><a href=\"#git-ahead-behind-info-between-master-and-branch\" class=\"headerlink\" title=\"git ahead/behind info between master and branch?\"></a><a href=\"http://stackoverflow.com/questions/20433867/git-ahead-behind-info-between-master-and-branch\" target=\"_blank\" rel=\"external\">git ahead/behind info between master and branch?</a></h4><p>First of all to see how many revisions you are behind locally, you should do a git fetch to make sure you have the latest info from your remote.</p>\n<p>The default output of git status tells you how many revisions you are ahead or behind, but usually I find this too verbose:</p>\n<p><em>$ git status</em> # On branch master # Your branch and ‘origin/master’ have diverged, # and have 2 and 1 different commit each, respectively. # nothing to commit (working directory clean)</p>\n<p>I prefer <em>git status -sb:</em><br><figure class=\"highlight armasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git status -<span class=\"built_in\">sb</span> ## master...origin/master [ahead <span class=\"number\">2</span>, <span class=\"keyword\">behind </span><span class=\"number\">1</span>]</span><br></pre></td></tr></table></figure></p>\n<p>In fact I alias this to simply git s, and this is the main command I use for checking status.</p>\n<p>To see the diff in the “ahead revisions” of master, I can exclude the “behind revisions” from origin/master:<br><figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff <span class=\"literal\">master</span>..origin/<span class=\"literal\">master</span>^</span><br></pre></td></tr></table></figure></p>\n<p>To see the diff in the “behind revisions” of origin/master, I can exclude the “ahead revisions” from master:<br><figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff origin/<span class=\"literal\">master</span>..<span class=\"literal\">master</span>^^</span><br></pre></td></tr></table></figure></p>\n<p>If there are 5 revisions ahead or behind it might be easier to write like this:<br><figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git diff <span class=\"literal\">master</span>..origin/<span class=\"literal\">master</span>~<span class=\"number\">5</span> git diff origin/<span class=\"literal\">master</span>..<span class=\"literal\">master</span>~<span class=\"number\">5</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"Git-Branching\"><a href=\"#Git-Branching\" class=\"headerlink\" title=\"Git Branching\"></a>Git Branching</h2><h4 id=\"Basic-Branching-and-Merging\"><a href=\"#Basic-Branching-and-Merging\" class=\"headerlink\" title=\"Basic Branching and Merging\"></a>Basic Branching and Merging</h4><p><a href=\"https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging\" target=\"_blank\" rel=\"external\">https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging</a></p>\n<h4 id=\"Get-changes-from-master-into-branch-in-git\"><a href=\"#Get-changes-from-master-into-branch-in-git\" class=\"headerlink\" title=\"Get changes from master into branch in git\"></a><a href=\"http://stackoverflow.com/questions/5340724/get-changes-from-master-into-branch-in-git\" target=\"_blank\" rel=\"external\">Get changes from master into branch in git</a></h4><p>Checkout the aq branch, then rebase from master.<br><figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout aq</span><br><span class=\"line\"></span><br><span class=\"line\">git rebase <span class=\"literal\">master</span></span><br></pre></td></tr></table></figure></p>\n<h4 id=\"Git-Branching-Rebasing\"><a href=\"#Git-Branching-Rebasing\" class=\"headerlink\" title=\"Git Branching - Rebasing\"></a>Git Branching - Rebasing</h4><p><a href=\"https://git-scm.com/book/en/v2/Git-Branching-Rebasing\" target=\"_blank\" rel=\"external\">https://git-scm.com/book/en/v2/Git-Branching-Rebasing</a></p>\n<h4 id=\"How-do-you-merge-selective-files-with-git-merge\"><a href=\"#How-do-you-merge-selective-files-with-git-merge\" class=\"headerlink\" title=\"How do you merge selective files with git-merge?\"></a><a href=\"http://stackoverflow.com/questions/449541/how-do-you-merge-selective-files-with-git-merge\" target=\"_blank\" rel=\"external\">How do you merge selective files with git-merge?</a></h4><p><a href=\"http://stackoverflow.com/questions/449541/how-do-you-merge-selective-files-with-git-merge\" target=\"_blank\" rel=\"external\">http://stackoverflow.com/questions/449541/how-do-you-merge-selective-files-with-git-merge</a></p>\n<p>use git add –patch or possibly git add –interactive which allows you to add just parts of a hun</p>\n<p><a href=\"https://www.haykranen.nl/2011/07/18/git-merging-specific-files-from-another-branch/\" target=\"_blank\" rel=\"external\">https://www.haykranen.nl/2011/07/18/git-merging-specific-files-from-another-branch/</a></p>\n<h4 id=\"Git-Delete-a-branch-local-or-remote\"><a href=\"#Git-Delete-a-branch-local-or-remote\" class=\"headerlink\" title=\"Git: Delete a branch (local or remote)\"></a>Git: Delete a branch (local or remote)</h4><p>To delete a local branch<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch <span class=\"_\">-d</span> the_<span class=\"built_in\">local</span>_branch</span><br></pre></td></tr></table></figure></p>\n<p>To remove a remote branch (if you know what you are doing!)<br><figure class=\"highlight maxima\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">push</span> <span class=\"built_in\">origin</span> :the_remote_branch</span><br></pre></td></tr></table></figure></p>\n"}]