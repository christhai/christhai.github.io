[{"title":"Deploying Applications with Elastic Beanstalk","url":"http://christhai.github.io/2016/07/11/Deploying-Applications-with-Elastic-Beanstalk/","content":"<p>Elastic Beanstalk Key Concepts</p>\n<p>Deploying a Web App with Beanstalk</p>\n<p>Working with the EB CLI</p>\n<p>Advanced Environment Customization</p>\n<p>Rolling &amp; Blue-green Deployments</p>\n<p>Working with Docker</p>\n"},{"title":"Test DOCKER.CLOUD(TUTUM) CD Automation Deployment","url":"http://christhai.github.io/2016/07/07/TEST-DOCKER-CLOUD-TUTUM-CD-AUTO-TOOL/","content":"<h3 id=\"Step-one-link-to-AMAZON-EC2\"><a href=\"#Step-one-link-to-AMAZON-EC2\" class=\"headerlink\" title=\"Step one, link to AMAZON EC2\"></a>Step one, link to AMAZON EC2</h3><p>Go to “cloud setting”, - “cloud providers”</p>\n<p>Create a IAM user “docker” and attach policy  “access to EC2”</p>\n<h3 id=\"Step-two-create-a-Node-clusters-and-nodes\"><a href=\"#Step-two-create-a-Node-clusters-and-nodes\" class=\"headerlink\" title=\"Step two, create a Node clusters and nodes\"></a>Step two, create a Node clusters and nodes</h3><h3 id=\"Step-three-build-services-from-Repository\"><a href=\"#Step-three-build-services-from-Repository\" class=\"headerlink\" title=\"Step three, build services from Repository\"></a>Step three, build services from Repository</h3><a id=\"more\"></a>\n<h3 id=\"Set-trigger\"><a href=\"#Set-trigger\" class=\"headerlink\" title=\"Set trigger\"></a>Set trigger</h3><h3 id=\"Finally-browser-endpoints-see-webApp\"><a href=\"#Finally-browser-endpoints-see-webApp\" class=\"headerlink\" title=\"Finally, browser endpoints see  webApp\"></a>Finally, browser endpoints see  webApp</h3><p>总结：</p>\n<p>和dockerhub捆绑挺好的，给单个容器比较好用  例如export server<br>但是不知道能不能push到 EB上，或者用stack功能  类似docker compose<br>因为ec2只是单个instance,没有其他组件Load balance 之类的  </p>\n"},{"title":"Using EB CLI","url":"http://christhai.github.io/2016/07/04/Using-EB-CLI/","content":"<p>During the Elasticbeanstalk deploy, it is good to use Eb cli command line, then we do not need to compress the Applicaiton.zip and upload the application file through Webconsole.</p>\n<p>One thing we need to do is make sure that we can authenticate to AWS before we can actually start deploying applications, so let’s create a brand new user to do this. So I’m going to go back into the AWS console, I’m going to go to Services, and then I’m going to go to AIM for Identity Access and Management. I’m going to go to Users to create a new user. So we’ll call this guy EB and hit Create. Now I’m going to need the access keys here so I’ll go ahead and download the credentials. And I’ll go ahead and open this up with Notepad, cause I’m going to need the keys here in just a minute. But for now, let’s go ahead and close this, and then we’ll set up the permissions for our EB user. So we’ll go into the EB user, go to the permissions tab, and then we’ll go ahead and attach a policy to this user. And of course here you could set up a granular policy based on your requirements. I’m just going to give this user administrator access, so we’ll go ahead and attach that policy, and now that we have a user that has permissions, we’re ready to configure the EB CLI and then we can deploy an application.</p>\n<a id=\"more\"></a>\n<p><strong>Commands review:</strong></p>\n<figure class=\"highlight basic\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">803 </span>eb init</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">804 </span> eb status</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">805 </span> eb status haiwTest-env</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">806 </span> eb deploy haiwTest-env</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">812 </span> eb logs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">814 </span> eb logs haiwTest-env</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">816 </span> eb use haiwTest-env-dev</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">821 </span> eb deploy</span><br></pre></td></tr></table></figure>\n<h3 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference:\"></a>Reference:</h3><h4 id=\"eb-deploy-的流程\"><a href=\"#eb-deploy-的流程\" class=\"headerlink\" title=\"eb deploy 的流程\"></a>eb deploy 的流程</h4><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_PHP_cakePHP.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_PHP_cakePHP.html</a></p>\n<h4 id=\"Using-Git-with-the-EB-CLI\"><a href=\"#Using-Git-with-the-EB-CLI\" class=\"headerlink\" title=\"Using Git with the EB CLI\"></a>Using Git with the EB CLI</h4><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-cli-git.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-cli-git.html</a></p>\n<p><a href=\"http://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/eb-cli3-getting-started.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/eb-cli3-getting-started.html</a></p>\n<h4 id=\"Configuring-the-AWS-Command-Line-Interface\"><a href=\"#Configuring-the-AWS-Command-Line-Interface\" class=\"headerlink\" title=\"Configuring the AWS Command Line Interface\"></a>Configuring the AWS Command Line Interface</h4><p><a href=\"http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html</a></p>\n<h4 id=\"More-EB-commands\"><a href=\"#More-EB-commands\" class=\"headerlink\" title=\"More EB commands:\"></a>More EB commands:</h4><p><strong>eb scale</strong></p>\n<p>Description</p>\n<p>Scales the environment to always run on a specified number of instances, setting both the minimum and maximum number of instances to the specified number.</p>\n"},{"title":"Set up website on Elastic Beanstalk using Multi Container","url":"http://christhai.github.io/2016/07/04/Set-up-website-on-Elastic-Beanstalk-using-Multi-Container/","content":"<h2 id=\"Set-up-website-on-Elastic-Beanstalk-using-Multi-Container-PHP-FPM-Nginx\"><a href=\"#Set-up-website-on-Elastic-Beanstalk-using-Multi-Container-PHP-FPM-Nginx\" class=\"headerlink\" title=\"Set up website on Elastic Beanstalk using Multi Container (PHP-FPM + Nginx)\"></a>Set up website on Elastic Beanstalk using Multi Container (PHP-FPM + Nginx)</h2><p>This guide shows you how to setup WebApp  on Elastic Beanstalk using the [PHP-FPM]and [Nginx] Docker images.</p>\n<h2 id=\"The-procedure-of-making-this-work\"><a href=\"#The-procedure-of-making-this-work\" class=\"headerlink\" title=\"The procedure of making this work\"></a>The procedure of making this work</h2><p><a href=\"#heading=h.rilr6oluuna3\">First step, covert docker compose file to Dockerrun.aws.json</a></p>\n<p><a href=\"#heading=h.txmc5fcrcsi1\">Second step, link to RDS</a></p>\n<p>—-&gt;   Think of security group, the instance  need access to RDS</p>\n<p>—-&gt;   Connecting MYSQL RDS needs php-mysql inside docker</p>\n<p>—-&gt;   Upload prebuild or private docker image (PHP with php-mysql) to ECR</p>\n<hr>\n<a id=\"more\"></a>\n<h3 id=\"First-step-covert-docker-compose-file-to-Dockerrun-aws-json\"><a href=\"#First-step-covert-docker-compose-file-to-Dockerrun-aws-json\" class=\"headerlink\" title=\"First step, covert docker compose file to Dockerrun.aws.json\"></a>First step, covert docker compose file to Dockerrun.aws.json</h3><p>Follow this tutorial  <a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html</a></p>\n<p><strong>Topics</strong></p>\n<ul>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create_deploy_docker_ecstutorial_role\" target=\"_blank\" rel=\"external\">Configure a Container Instance IAM Role</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create_deploy_docker_ecstutorial_config\" target=\"_blank\" rel=\"external\">Define Docker Containers</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create_deploy_docker_ecstutorial_code\" target=\"_blank\" rel=\"external\">Add Content</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create_deploy_docker_ecstutorial_deploy\" target=\"_blank\" rel=\"external\">Deploy to Elastic Beanstalk</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create_deploy_docker_ecstutorial_connect\" target=\"_blank\" rel=\"external\">Connect to a Container Instance</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create_deploy_docker_ecstutorial_connect_inspect\" target=\"_blank\" rel=\"external\">Inspect the Amazon ECS Container Agent</a></p>\n</li>\n</ul>\n<p>PS: you can login to the EC2 instance which host docker containers and  the WebAPP could be found on /var/app/current:</p>\n<figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ec2-user@ip-10-0-0-117 ~]$ <span class=\"keyword\">ls</span> /<span class=\"keyword\">var</span>/<span class=\"keyword\">app</span>/current</span><br><span class=\"line\">Dockerrun.aws.json  php-<span class=\"keyword\">app</span>  proxy</span><br></pre></td></tr></table></figure>\n<p>Until now, the webapp is running without the mysql connection</p>\n<h3 id=\"Second-step-link-to-RDS-Mysql\"><a href=\"#Second-step-link-to-RDS-Mysql\" class=\"headerlink\" title=\"Second step, link to RDS Mysql\"></a>Second step, link to RDS Mysql</h3><h4 id=\"1-Think-of-security-group-the-instance-need-access-to-RDS\"><a href=\"#1-Think-of-security-group-the-instance-need-access-to-RDS\" class=\"headerlink\" title=\"1. Think of security group, the instance  need access to RDS\"></a>1. Think of security group, the instance  need access to RDS</h4><p><a href=\"http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithSecurityGroups.html#USER_WorkingWithSecurityGroups.AuthorizingEC2\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithSecurityGroups.html#USER_WorkingWithSecurityGroups.AuthorizingEC2</a></p>\n<p>Login into EC2 instance and see whether can be able to visit RDS</p>\n<p>troubleshooting</p>\n<p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/java-rds.html#create_deploy_Java.rds.troubleshooting\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/java-rds.html#create_deploy_Java.rds.troubleshooting</a></p>\n<p>More reference:</p>\n<p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_PHP.rds.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_PHP.rds.html</a></p>\n<p><a href=\"https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.RDS.html\" target=\"_blank\" rel=\"external\">https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.RDS.html</a></p>\n<p><a href=\"https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.RDS.html#rds-external-ec2classic\" target=\"_blank\" rel=\"external\">https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.RDS.html#rds-external-ec2classic</a></p>\n<p>So far, EC2 instance can access to RDS mysql however Webapp still not work.</p>\n<p>We need mysql client to connect BY USING php-mysql</p>\n<h4 id=\"2-Connecting-MYSQL-RDS-needs-php-mysql-inside-docker\"><a href=\"#2-Connecting-MYSQL-RDS-needs-php-mysql-inside-docker\" class=\"headerlink\" title=\"2. Connecting MYSQL RDS needs php-mysql inside docker\"></a>2. Connecting MYSQL RDS needs php-mysql inside docker</h4><p>Firstly, I add one more database container and test. It was not working.<br>Then I realized I do not need a separate DB container actually. The thing I need is the prebuild or private docker image (PHP with php-mysql)**</p>\n<p>Here is a good doc i followed that solved this:</p>\n<p><a href=\"http://www.michaelgallego.fr/blog/2015/07/18/using-elastic-beanstalk-multi-container-with-php/\" target=\"_blank\" rel=\"external\">http://www.michaelgallego.fr/blog/2015/07/18/using-elastic-beanstalk-multi-container-with-php/</a></p>\n<p>I wanna use docker private images (haiw/php-fpm) in Dockerrun.aws.json, but after testing, I found that it is not allowed and it cause deploy issue.  </p>\n<p>Need to figure out a alternative way.</p>\n<h4 id=\"3-Upload-prebuild-or-private-docker-image-PHP-with-php-mysql-to-ECR\"><a href=\"#3-Upload-prebuild-or-private-docker-image-PHP-with-php-mysql-to-ECR\" class=\"headerlink\" title=\"3. Upload prebuild or private docker image (PHP with php-mysql) to ECR\"></a>3. Upload prebuild or private docker image (PHP with php-mysql) to ECR</h4><p>Toturial:<br><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker.html#docker-images-private\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker.html#docker-images-private</a></p>\n<p>Here is what I did,  </p>\n<p><a href=\"http://aws.amazon.com/ecr/getting-started/\" target=\"_blank\" rel=\"external\">http://aws.amazon.com/ecr/getting-started/</a></p>\n<p>upload docker image to Amazon ECR to use</p>\n<p><img src=\"images/201607/image_6.png\" alt=\"image alt text\"></p>\n<p><a href=\"http://docs.aws.amazon.com/AmazonECR/latest/userguide/get-set-up-for-amazon-ecr.html\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/AmazonECR/latest/userguide/get-set-up-for-amazon-ecr.html</a></p>\n<p>Commands review:</p>\n<figure class=\"highlight basic\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">543 </span> aws ecr <span class=\"keyword\">get</span>-login --region us-east-<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">544 </span> aws configure</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">545 </span> aws ecr <span class=\"keyword\">get</span>-login --region us-east-<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">546 </span> ls</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">547 </span> docker login -u AWS -p CiBwm0YaISJ</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">566 </span> docker build -t haiw/php-fpm:latest .</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">567 </span> docker images</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">568 </span> docker tag  haiw/php-fpm:latest <span class=\"number\">429834746942.d</span>kr.ecr.us-east-<span class=\"number\">1.</span>amazonaws.<span class=\"keyword\">com</span>/php-fpm:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">569 </span> docker push <span class=\"number\">429834746942.d</span>kr.ecr.us-east-<span class=\"number\">1.</span>amazonaws.<span class=\"keyword\">com</span>/php-fpm:latest</span><br></pre></td></tr></table></figure>\n<p>EB APP use docker image from ECR, it also requires permission</p>\n<h4 id=\"4-Configure-Container-Instance-IAM-Role\"><a href=\"#4-Configure-Container-Instance-IAM-Role\" class=\"headerlink\" title=\"4.Configure Container Instance IAM Role\"></a>4.Configure Container Instance IAM Role</h4><p>Instances in a multicontainer Docker environment must have an instance profile with permission to access Amazon EC2 Container Service (Amazon ECS), the service that Elastic Beanstalk uses to coordinate container deployments. To grant Amazon ECS access to the instances in your environment, you must create an IAM container instance policy and attach the policy to the correct IAM role.</p>\n<p><strong>Topics</strong></p>\n<ul>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create-policy\" target=\"_blank\" rel=\"external\">Create the Policy</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#create-role\" target=\"_blank\" rel=\"external\">Create the Role (if needed)</a></p>\n</li>\n<li><p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_ecstutorial.html#attach-policy\" target=\"_blank\" rel=\"external\">Attach the Policy to the Role</a></p>\n</li>\n</ul>\n<p>Conclude:<br>EC2 instance needs security group   and   IAM  role   </p>\n<p><strong>让rds给instance  权限 从rds 的 security groups中去授权</strong></p>\n<p><strong>而instance访问 ecs 或者 ecr 在 IAM中设置 </strong></p>\n<p>给 <strong>aws-elasticbeanstalk-ec2-role</strong> 授予权限</p>\n"},{"title":"Create and push php-fpm docker image on AWS ECR(Container Registry)","url":"http://christhai.github.io/2016/06/29/Create-a-new-php-fpm-docker-image-on-AWS-ECR/","content":"<p>You can store your custom Docker images in AWS with <a href=\"http://aws.amazon.com/ecr\" target=\"_blank\" rel=\"external\">Amazon EC2 Container Registry</a> (Amazon ECR). When you store your Docker images in Amazon ECR, Elastic Beanstalk automatically authenticates to the Amazon ECR registry with your environment’s <a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/concepts-roles.html#concepts-roles-instance\" target=\"_blank\" rel=\"external\">instance profile</a>, so you don’t need to <a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker.container.console.html#docker-images-private\" target=\"_blank\" rel=\"external\">generate an authentication file</a> and upload it to Amazon Simple Storage Service (Amazon S3)</p>\n<p>The official tutorial is here,</p>\n<p><a href=\"http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker.html#docker-images-private\" target=\"_blank\" rel=\"external\">http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker.html#docker-images-private</a></p>\n<p>or you can get started from here and follow the guide:</p>\n<p><a href=\"http://aws.amazon.com/ecr/getting-started/\" target=\"_blank\" rel=\"external\">http://aws.amazon.com/ecr/getting-started/</a></p>\n<p>Take a example,  Create a new php-fpm docker image on AWS ECR Used for docker muti-container on EB</p>\n<p><strong>Command review:</strong></p>\n<figure class=\"highlight basic\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">480 </span> aws ecr <span class=\"keyword\">get</span>-login --region us-east-<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"symbol\">481 </span> docker login -u AWS -p</span><br><span class=\"line\"><span class=\"symbol\">482 </span> docker images</span><br><span class=\"line\"><span class=\"symbol\">483 </span> docker build -t christhai/php-app .</span><br><span class=\"line\"><span class=\"symbol\">491 </span> docker tag christhai/php-app:latest <span class=\"number\">42</span>xxxxxxxx2.dkr.ecr.us-east-<span class=\"number\">1.</span>amazonaws.<span class=\"keyword\">com</span>/christhai:php-app</span><br><span class=\"line\"><span class=\"symbol\">492 </span> docker images</span><br><span class=\"line\"><span class=\"symbol\">493 </span> docker push <span class=\"number\">42</span>xxxxxxxx2.dkr.ecr.us-east-<span class=\"number\">1.</span>amazonaws.<span class=\"keyword\">com</span>/christhai:php-app</span><br></pre></td></tr></table></figure>\n<p>  <img src=\"/images/201607/image_6.png\" alt=\"\"></p>\n<p>  <strong>The another thing we have to think about grant permission to instance or EB application IAM ROLE use container from ECR.</strong></p>\n<p>  Take export-server as example, the EB application IAM Role is aws-eleasticbeanstalk-ec2-role</p>\n<p>  Since export serve is build from docker image on Amazon ECR, then we should assign the policy “<a href=\"https://console.aws.amazon.com/iam/home?region=us-west-2#policies/arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryFullAccess\" target=\"_blank\" rel=\"external\">AmazonEC2ContainerRegistryFullAccess</a>“  to aws-eleasticbeanstalk-ec2-role</p>\n<pre><code>![](/images/201607/image_7.png)\n</code></pre>"},{"title":"Git Skills","url":"http://christhai.github.io/2016/06/29/Git-Skills/","content":"<h1 id=\"How-do-I-resolve-git-saying-“Commit-your-changes-or-stash-them-before-you-can-merge”\"><a href=\"#How-do-I-resolve-git-saying-“Commit-your-changes-or-stash-them-before-you-can-merge”\" class=\"headerlink\" title=\"How do I resolve git saying “Commit your changes or stash them before you can merge”?\"></a><a href=\"http://stackoverflow.com/questions/15745045/how-do-i-resolve-git-saying-commit-your-changes-or-stash-them-before-you-can-me\" target=\"_blank\" rel=\"external\">How do I resolve git saying “Commit your changes or stash them before you can merge”?</a></h1><p>you can’t merge with local modifications. Git protects you from losing potentially important changes. You have three options. One is to commit the change using</p>\n<p>git commit -m “My message”</p>\n<p>The second is to stash it. stashing acts as a stack, where you can push changes, and you pop them in reverse order.</p>\n<p>To stash type:</p>\n<p>git stash</p>\n<p>Do the merge, and than pull the stash:</p>\n<p>git stash pop</p>\n<a id=\"more\"></a>\n<p>The third options is to discard the local changes using git reset –hard</p>\n<h1 id=\"How-to-view-file-diff-in-git-before-commit\"><a href=\"#How-to-view-file-diff-in-git-before-commit\" class=\"headerlink\" title=\"How to view file diff in git before commit\"></a><a href=\"http://stackoverflow.com/questions/10039747/how-to-view-file-diff-in-git-before-commit\" target=\"_blank\" rel=\"external\">How to view file diff in git before commit</a></h1><p>If you want to see what you haven’t git added yet:</p>\n<p>git diff – myfile.txt</p>\n<p>or if you want to see already-added changes</p>\n<p>git diff –cached – myfile.txt</p>\n<p>or</p>\n<p>git diff HEAD file</p>\n<p>will show you changes you added to your worktree from the last commit. All the changes (staged or not staged) will be shown.</p>\n<h1 id=\"Showing-which-files-have-changed-between-two-revisions\"><a href=\"#Showing-which-files-have-changed-between-two-revisions\" class=\"headerlink\" title=\"Showing which files have changed between two revisions\"></a><a href=\"http://stackoverflow.com/questions/822811/showing-which-files-have-changed-between-two-revisions\" target=\"_blank\" rel=\"external\">Showing which files have changed between two revisions</a></h1><p>Try</p>\n<p>$ git diff –name-status master..branchName</p>\n<h1 id=\"How-can-I-compare-files-from-two-different-branches\"><a href=\"#How-can-I-compare-files-from-two-different-branches\" class=\"headerlink\" title=\"How can I compare files from two different branches?\"></a><a href=\"http://stackoverflow.com/questions/4099742/how-can-i-compare-files-from-two-different-branches\" target=\"_blank\" rel=\"external\">How can I compare files from two different branches?</a></h1><p>git diff can show you the difference between two commits:</p>\n<p>git diff mybranch master – myfile.cs</p>\n<h1 id=\"Differences-for-a-certain-folder-between-remote-git-branches\"><a href=\"#Differences-for-a-certain-folder-between-remote-git-branches\" class=\"headerlink\" title=\"Differences for a certain folder between remote git branches\"></a><a href=\"http://stackoverflow.com/questions/12123633/differences-for-a-certain-folder-between-git-branches\" target=\"_blank\" rel=\"external\">Differences for a certain folder between remote git branches</a></h1><p>git diff master..origin/yourbranch path/to/folder</p>\n<h1 id=\"How-do-you-merge-selective-files-with-git-merge\"><a href=\"#How-do-you-merge-selective-files-with-git-merge\" class=\"headerlink\" title=\"How do you merge selective files with git-merge?\"></a><a href=\"http://stackoverflow.com/questions/449541/how-do-you-merge-selective-files-with-git-merge\" target=\"_blank\" rel=\"external\">How do you merge selective files with git-merge?</a></h1><p><a href=\"http://stackoverflow.com/questions/449541/how-do-you-merge-selective-files-with-git-merge\" target=\"_blank\" rel=\"external\">http://stackoverflow.com/questions/449541/how-do-you-merge-selective-files-with-git-merge</a></p>\n<p>use git add –patch or possibly git add –interactive which allows you to add just parts of a hun</p>\n<p><a href=\"https://www.haykranen.nl/2011/07/18/git-merging-specific-files-from-another-branch/\" target=\"_blank\" rel=\"external\">https://www.haykranen.nl/2011/07/18/git-merging-specific-files-from-another-branch/</a></p>\n<h1 id=\"Git-Delete-a-branch-local-or-remote\"><a href=\"#Git-Delete-a-branch-local-or-remote\" class=\"headerlink\" title=\"Git: Delete a branch (local or remote)\"></a><strong>Git: Delete a branch (local or remote)</strong></h1><p>To delete a local branch</p>\n<p>git branch -d the_local_branch</p>\n<p>To remove a remote branch (if you know what you are doing!)</p>\n<p>git push origin :the_remote_branch</p>\n<h1 id=\"Git-HowTo-revert-a-commit-already-pushed-to-a-remote-repository\"><a href=\"#Git-HowTo-revert-a-commit-already-pushed-to-a-remote-repository\" class=\"headerlink\" title=\"Git HowTo: revert a commit already pushed to a remote repository\"></a><strong>Git HowTo: revert a commit already pushed to a remote repository</strong></h1><h2 id=\"Case-1-Delete-the-last-commit\"><a href=\"#Case-1-Delete-the-last-commit\" class=\"headerlink\" title=\"Case 1: Delete the last commit\"></a><strong>Case 1: Delete the last commit</strong></h2><p>Deleting the last commit is the easiest case. Let’s say we have a remote <em>mathnet</em>with branch <em>master</em> that currently points to commit <em>dd61ab32</em>. We want to remove the top commit. Translated to git terminology, we want to force the <em>master</em> branch of the <em>mathnet</em> remote repository to the parent of <em>dd61ab32</em>:</p>\n<table><br>  <tr><br>    <td>1:<br></td><br>    <td>$ git push mathnet +dd61ab32^:master<br></td><br>  </tr><br></table>\n\n\n<p>Where git interprets x^ as the parent of x and + as a forced non-fastforward push. If you have the master branch checked out locally, you can also do it in two simpler steps: First reset the branch to the parent of the current commit, then force-push it to the remote.</p>\n<table><br>  <tr><br>    <td>1:<br>2:<br></td><br>    <td>$ git reset HEAD^ –hard<br>$ git push mathnet -f</td><br>  </tr><br></table>\n\n\n<h3 id=\"Undo-a-commit-and-redo\"><a href=\"#Undo-a-commit-and-redo\" class=\"headerlink\" title=\"Undo a commit and redo\"></a><strong>Undo a commit and redo</strong></h3><p>$ git commit -m “Something terribly misguided” (1)</p>\n<p>$ git reset –soft HEAD~ (2)</p>\n<h1 id=\"git-ahead-behind-info-between-master-and-branch\"><a href=\"#git-ahead-behind-info-between-master-and-branch\" class=\"headerlink\" title=\"git ahead/behind info between master and branch?\"></a><a href=\"http://stackoverflow.com/questions/20433867/git-ahead-behind-info-between-master-and-branch\" target=\"_blank\" rel=\"external\">git ahead/behind info between master and branch?</a></h1><p>First of all to see how many revisions you are behind locally, you should do a git fetch to make sure you have the latest info from your remote.</p>\n<p>The default output of git status tells you how many revisions you are ahead or behind, but usually I find this too verbose:</p>\n<p>$ git status # On branch master # Your branch and ‘origin/master’ have diverged, # and have 2 and 1 different commit each, respectively. # nothing to commit (working directory clean)</p>\n<p>I prefer git status -sb:</p>\n<p>$ git status -sb ## master…origin/master [ahead 2, behind 1]</p>\n<p>In fact I alias this to simply git s, and this is the main command I use for checking status.</p>\n<p>To see the diff in the “ahead revisions” of master, I can exclude the “behind revisions” from origin/master:</p>\n<p>git diff master..origin/master^</p>\n<p>To see the diff in the “behind revisions” of origin/master, I can exclude the “ahead revisions” from master:</p>\n<p>git diff origin/master..master^^</p>\n<p>If there are 5 revisions ahead or behind it might be easier to write like this:</p>\n<p>git diff master..origin/master~5 git diff origin/master..master~5</p>\n<h1 id=\"Git-Branching-Basic-Branching-and-Merging\"><a href=\"#Git-Branching-Basic-Branching-and-Merging\" class=\"headerlink\" title=\"Git Branching - Basic Branching and Merging\"></a>Git Branching - Basic Branching and Merging</h1><p><a href=\"https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging\" target=\"_blank\" rel=\"external\">https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging</a></p>\n<h1 id=\"Get-changes-from-master-into-branch-in-git\"><a href=\"#Get-changes-from-master-into-branch-in-git\" class=\"headerlink\" title=\"Get changes from master into branch in git\"></a><a href=\"http://stackoverflow.com/questions/5340724/get-changes-from-master-into-branch-in-git\" target=\"_blank\" rel=\"external\">Get changes from master into branch in git</a></h1><p>Checkout the aq branch, then rebase from master.</p>\n<p>git checkout aq</p>\n<p>git rebase master</p>\n<h1 id=\"Git-Branching-Rebasing\"><a href=\"#Git-Branching-Rebasing\" class=\"headerlink\" title=\"Git Branching - Rebasing\"></a>Git Branching - Rebasing</h1><p><a href=\"https://git-scm.com/book/en/v2/Git-Branching-Rebasing\" target=\"_blank\" rel=\"external\">https://git-scm.com/book/en/v2/Git-Branching-Rebasing</a></p>\n"}]